[comment encoding = UTF-8 /]
[module generateFactoryTest('http://www.eclipse.org/emf/2002/Ecore')/]

[import soft::generator::go::generateCommon/]
[import soft::generator::go::lib::generateCommon/]
[import soft::generator::common::generateCommon/]

[template public generateFactoryTest(ePackage : EPackage)]
[file (ePackage.getOutputDirectory() + '/' + ePackage.getFactoryTestFileName(ePackage.name), false, 'UTF-8')]
[fileComment()/]

package [ePackage.name/]

import (
	"testing"

	"github.com/stretchr/testify/assert"
	[if not ePackage.isEcorePackage()]"github.com/masagroup/soft/go/ecore"[/if]
)

func TestFactoryCreate(t *testing.T) {
	factory := new[ePackage.name.toUpperFirst()/]FactoryImpl()
    [for (aClass : EClass | ePackage.eAllContents(EClass)->asOrderedSet()->sortedBy(name)) ? (aClass.abstract=false)]
	{
		mockEClass := &[if not ePackage.isEcorePackage()]ecore.[/if]MockEClass{}
		mockEClass.On("GetClassifierID").Return([aClass.getClassifierIDName()/])
		assert.NotNil(t, factory.Create(mockEClass))
	}
    [/for]
}

func TestFactoryPanics(t *testing.T) {
	factory := new[ePackage.name.toUpperFirst()/]FactoryImpl()
	[for (aDataType : EDataType | ePackage.eAllContents(EDataType)->select( serializable )->sortedBy(name))]
    {
		mockEDataType := &[if not ePackage.isEcorePackage()]ecore.[/if]MockEDataType{}
		mockEDataType.On("GetClassifierID").Return([aDataType.getClassifierIDName()/])
		assert.Panics(t, func() { factory.CreateFromString(mockEDataType, "") })
    }
	[/for]
	[for (aDataType : EDataType | ePackage.eAllContents(EDataType)->select( serializable )->sortedBy(name))]
    {
		mockEDataType := &[if not ePackage.isEcorePackage()]ecore.[/if]MockEDataType{}
		mockEDataType.On("GetClassifierID").Return([aDataType.getClassifierIDName()/])
		assert.Panics(t, func() { factory.ConvertToString(mockEDataType, "") })
    }
	[/for]
}
[/file]
[/template]