[comment encoding = UTF-8 /]
[module generateType('http://www.eclipse.org/emf/2002/Ecore')/]

[import soft::generator::ts::generateCommon/]

[query private getAllDataTypes(o : OclAny) : Sequence( Sequence( String ) ) = 
    Sequence {
        Sequence{ 'EBoolean' , 'EBooleanObject' , 'Boolean'  , 'boolean' , 'false' ,''},
        Sequence{ 'EInt' , 'EIntegerObject' , 'EBigInteger' , 'Integer'  , 'number' , '0' ,''},
        Sequence{ 'EDouble' , 'EDoubleObject' , 'EBigDecimal' , 'Real'  , 'number' , '0.' ,''},
        Sequence{ 'ELong' , 'ELongObject' , 'number' , '0' ,''},
        Sequence{ 'EByte' , 'EByteObject' 'EChar' , 'ECharacterObject', 'number' , '0', ''},
        Sequence{ 'EByteArray' , 'string' , '' ,''},
		Sequence{ 'EFeatureMapEntry' , 'EFeatureMapEntry' , '' ,'"./EFeatureMap"'},
        Sequence{ 'EFloat' , 'EFloatObject', 'number' , '0.0',''},
        Sequence{ 'EEList' , 'EList', '','"./EList"'},
        Sequence{ 'EDate' , 'std::time_t', 'std::time_t(-1)' , '<ctime>'},
        Sequence{ 'EMap' , 'Map', '' , ''},
        Sequence{ 'EJavaObject', 'EEnumerator' , 'EDiagnosticChain' , 'any', '' , ''},
        Sequence{ 'EJavaClass' , 'any', '' , ''},
        Sequence{ 'EString' , 'String', 'string', '""' , ''},
        Sequence{ 'ETreeIterator' , 'ECollectionView', '' , '"./ECollectionView"'},
        Sequence{ 'EResource' , 'EResource', '' , '"./EResource"'}
    }
/]

[query public getTypeName(aClassifier : EClassifier ) : String = 
    if aClassifier.oclIsUndefined() then 'any'
    else if aClassifier.oclIsKindOf( EClass ) then aClassifier.oclAsType(EClass).getTypeName()
    else if aClassifier.oclIsKindOf( EEnum ) then aClassifier.oclAsType(EEnum).getTypeName()
    else if aClassifier.oclIsKindOf( EDataType ) then aClassifier.oclAsType(EDataType).getTypeName()
    else '' endif endif endif endif
/]
[query private getTypeName( aClass : EClass ) : String = aClass.getInterfaceName()/]
[query private getTypeName( aEnum : EEnum ) : String = aEnum.name/]
[query private getTypeName( aDataType : EDataType ) : String = 
    getAllDataTypes()->iterate( s ; res : String = '' |
    if res = '' then
        if s->exists(n : String | n = aDataType.name) then
            s->at( s->size() - 2 )
        else
            res
        endif
    else 
        res 
    endif
 ) 
/] 


[query public getTypeImport( aClassifier : EClassifier ) : String = 
    if aClassifier.oclIsUndefined() then ''
    else if aClassifier.oclIsKindOf( EClass ) then aClassifier.oclAsType(EClass).getTypeImport()
    else if aClassifier.oclIsKindOf( EEnum ) then aClassifier.oclAsType(EEnum).getTypeImport()
    else if aClassifier.oclIsKindOf( EDataType ) then aClassifier.oclAsType(EDataType).getTypeImport()
    else '' endif endif endif endif
/]
[query public getTypeImport( aName : String ) : String = '"./' + aName + '"'/]

[query private getTypeImport( aClass : EClass ) : String = getTypeImport(aClass.getInterfaceName()) /]
[query private getTypeImport( aEnum : EEnum ) : String = getTypeImport(aEnum.name)/]
[query private getTypeImport( aDataType : EDataType ) : String = 
    getAllDataTypes()->iterate( s ; res : String = '' |
    if res = '' then
        if s->exists(n : String | n = aDataType.name) then
            s->at( s->size() )
        else
            res
        endif
    else 
        res 
    endif
 ) 
/]